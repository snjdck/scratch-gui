const OpCode = require("../OpCode");
const OpFactory = require("../OpFactory");

function calculate(codeList)
{
	for(var i=1, n=codeList.length; i<n; ++i){
		var prevIndex = i - 1;
		var prevCode = codeList[prevIndex];
		var code = codeList[i];
		
		if(code[0] == OpCode.JUMP_IF_FALSE){
			if(prevCode[0] == OpCode.PUSH){
				codeList[prevIndex] = OpFactory.Jump(1);
				code[0] = OpCode.JUMP;
				if(prevCode[1]){
					code[1] = 1;
				}
			}else if(prevCode[0] == OpCode.IS_POSITIVE){
				codeList[prevIndex] = OpFactory.Jump(1);
				code[0] = OpCode.JUMP_IF_NOT_POSITIVE;
			}
		}
	}
}

exports.calculate = calculate;